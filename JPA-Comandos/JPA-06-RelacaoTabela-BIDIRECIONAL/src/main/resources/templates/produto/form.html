<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
	<meta charset="UTF-8">
	<title>Produtos</title>
</head>

<body>

	<h2>Cadastro de Produto</h2>

	<form th:action="${produto.id} != null ? @{/produtos/editar} : @{/produtos}" th:object="${produto}" method="post"
		enctype="multipart/form-data">

		<input type="hidden" th:field="*{id}" />

		<div>
			<label>Nome</label>
			<input type="text" th:field="*{nome}" />

			<label>Preço</label>
			<input type="number" step="0.01" th:field="*{preco}" />

			<label>Imagem</label>
			<input type="file" name="arquivo" />
		</div>
		<br>

		<div>
			<label>Categoria</label>
			<select th:field="*{categoriaId}">
				<option value="">Selecione</option>
				<option th:each="c : ${categorias}" th:value="${c.id}" th:text="${c.nome}">
				</option>
			</select>

			<label>Fornecedor</label>
			<select th:field="*{fornecedorId}">
				<option value="">Selecione</option>
				<option th:each="f : ${fornecedores}" th:value="${f.id}" th:text="${f.nome}">
				</option>
			</select>

			<button type="submit">
				<span th:text="${produto.id} != null ? 'Atualizar' : 'Salvar'"></span>
			</button>
		</div>
	</form>

	<hr>

	<h3>Lista de Produtos</h3>

	<table border="1" cellpadding="8">
		<thead>
			<tr>
				<th>Imagem</th>
				<th>Nome</th>
				<th>Preço</th>
				<th>Categoria</th>
				<th>Fornecedor</th>
				<th>Ações</th>
			</tr>
		</thead>

		<tbody>
			<tr th:each="p : ${produtos}">
				<td>
					<img th:if="${p.imagem != null}" th:src="@{/imagens/{img}(img=${p.imagem})}" width="50"
						height="50" />
				</td>

				<td th:text="${p.nome}"></td>
				<td th:text="${p.preco}"></td>
				<td th:text="${p.categoria.nome}"></td>
				<td th:text="${p.fornecedor.nome}"></td>

				<td>
					<a th:href="@{/produtos/editar/{id}(id=${p.id})}" 
					sec:authorize="hasRole('ADMIN')">
						Editar
					</a>

					<form th:action="@{/produtos/excluir/{id}(id=${p.id})}" method="post" style="display:inline"
						sec:authorize="hasRole('ADMIN')">

						<button type="submit" onclick="return confirm('Deseja excluir este produto?')">
							Excluir
						</button>
					</form>
				</td>
			</tr>
		</tbody>
	</table>

</body>

</html>